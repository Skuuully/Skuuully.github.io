<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.22.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Gravity game - Ryan Skull</title>
<meta name="description" content="A university module required the creation of a game that looks at and implements an advanced physics topic, and an advanced AI topic.  For this I created the following available for download. For the physics topic I looked at gravity such that an object being an attractee could be attracted to another object the attractor,  allowing the attractees to be attracted to and move around an attractor. Then for the AI I wanted agents that could move around the surface  of the attractor, this led me to discover flow field pathfinding. This led to the creation of a game where the player can move around  small differently shaped planets shooting enemies that chase them, the game had an added element of uniqueness as players can shoot themselves  when their bullets wrap back around the planet to hit them.">


  <meta name="author" content="Ryan Skull">
  
  <meta property="article:author" content="Ryan Skull">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_GB">
<meta property="og:site_name" content="Ryan Skull">
<meta property="og:title" content="Gravity game">
<meta property="og:url" content="http://localhost:4000/gravity/">


  <meta property="og:description" content="A university module required the creation of a game that looks at and implements an advanced physics topic, and an advanced AI topic.  For this I created the following available for download. For the physics topic I looked at gravity such that an object being an attractee could be attracted to another object the attractor,  allowing the attractees to be attracted to and move around an attractor. Then for the AI I wanted agents that could move around the surface  of the attractor, this led me to discover flow field pathfinding. This led to the creation of a game where the player can move around  small differently shaped planets shooting enemies that chase them, the game had an added element of uniqueness as players can shoot themselves  when their bullets wrap back around the planet to hit them.">







  <meta property="article:published_time" content="2021-05-08T11:08:00+01:00">





  

  


<link rel="canonical" href="http://localhost:4000/gravity/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Ryan Skull",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Ryan Skull Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Ryan Skull
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">Gravity game</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Ryan Skull</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Programmer who makes stuff</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Midlands, UK</span>
        </li>
      

      
        
          
            <li><a href="mailto:skuuully@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://github.com/skuuully" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://skuuully.itch.io" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Itch</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <a href="/about/"><span class="nav__sub-title">About</span></a>
        

        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Posts</span>
        

        
        <ul>
          
            <li><a href="/gravity/" class="active">Gravity</a></li>
          
            <li><a href="/cvrs/">Covid visualisation</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <a href="/_assets/CV.docx"><span class="nav__sub-title">CV</span></a>
        

        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Gravity game">
    <meta itemprop="description" content="A university module required the creation of a game that looks at and implements an advanced physics topic, and an advanced AI topic. For this I created the following available for download.For the physics topic I looked at gravity such that an object being an attractee could be attracted to another object the attractor, allowing the attractees to be attracted to and move around an attractor. Then for the AI I wanted agents that could move around the surface of the attractor, this led me to discover flow field pathfinding. This led to the creation of a game where the player can move around small differently shaped planets shooting enemies that chase them, the game had an added element of uniqueness as players can shoot themselves when their bullets wrap back around the planet to hit them.">
    <meta itemprop="datePublished" content="2021-05-08T11:08:00+01:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Gravity game
</h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-05-08T11:08:00+01:00">May 8, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>A university module required the creation of a game that looks at and implements an advanced physics topic, and an advanced AI topic. 
For this I created the <a href="https://skuuully.itch.io/planet-game">following</a> available for download.
For the physics topic I looked at gravity such that an object being an attractee could be attracted to another object the attractor,
 allowing the attractees to be attracted to and move around an attractor. Then for the AI I wanted agents that could move around the surface
 of the attractor, this led me to discover flow field pathfinding. This led to the creation of a game where the player can move around
 small differently shaped planets shooting enemies that chase them, the game had an added element of uniqueness as players can shoot themselves
 when their bullets wrap back around the planet to hit them.</p>

<h2>Physics: Gravity</h2>
<p>The functionality is split out into two main parts, attractors and attractees. By doing so this allows control over which objects are attracted to the planets, and which objects serve as the planets. Attractees work using Unity’s rigidbody – however the rotation is frozen giving control of the rotation, and gravity disabled, allowing for a custom gravity implementation. The behaviour of an attractee is to find the attractors face that the attractee is nearest; this is done by ray casts. Once an attractor is found, use the surface normal from the ray cast to orient the object so that its up is in line with the surface normal. First a ray is cast downwards from the attractee, in most cases this will find the attractor, and for a spherical planet is the only method required. However, for cube shaped planets this alone will not work as walking off the edge of a body will not find the surface. In this scenario a cone of rays is cast below the player.</p>
<p><img src="/_assets/images/gravity/WalkDemo.gif" alt="WalkDemo" /></p>

<p>Also implemented are projectiles that can be shot by the player. A projectile is an attractee, combining this with a constant forward force allows the projectile to move forwards. As it moves around a surface its forwards will change allowing it to wrap around a sphere. Most basic unity meshes have been tested that would make sense as a play space, such as sphere, cube, capsule, and cylinder. All allow the projectiles to move around them in a believable way.</p>
<p><img src="/_assets/images/gravity/SelfShooting.gif" alt="Selfshoot" /></p>
<p>For this, assumptions are made that there is no air resistance, or changes in air pressure. The level of gravity also remains the same regardless of the distance from the surface, or centre of mass for the attractor. Additionally, all objects are assumed to be rigid. These assumptions are made, as including them would add extra complexity which is unnecessary for the game feel. As the attractor to use is always decided by looking below the attractee then we cannot transition from the sphere to the cube. The angle is too large between the two to be recognised. Another limitation is that models used as attractors must be fairly high poly for attractees to smoothly follow the shape of the object. Otherwise a low poly sphere for example may not feel very sphere like to move around.</p>

<h2>AI: Flow field pathfinding</h2>
<p>Flow-field pathfinding is used to allow pathfinding on the exterior of 3d objects. One of the main difficulties to implementing this is generating the nodes and connections to apply the pathfinding to. To generate the nodes the mesh data of the object is used. Foreach triangle in the mesh a node is created which is connected to the other nodes in the triangle. Only the shortest of the two connections are connected to avoid diagonal connections, diagonals can cause issues when obstacles are present. Once converted there will be multiple nodes with the same position where the triangles meet. So, merge nodes with the same position into one node containing all connections of the nodes in the same position. This can generate a grid to find a path on.</p>
<p><img src="/_assets/images/gravity/SphereGrid.png" alt="SphereGrid" /></p>

<p>As mesh data is used, this can present issues with there being too few nodes. To counter this the mesh may be subdivided multiple times first, decreasing the size of the mesh triangles but increasing the number of nodes in the grid making it more accurate. A comparison of a cube subdivided 0 times against 3 times can be seen below. To subdivide the mesh an external <a href="https://wiki.unity3d.com/index.php/MeshHelper">source</a> has been used.
<img src="/_assets/images/gravity/SubdivComparison.png" alt="Subdiv" /></p>

<p>With the grid generated the flow-field technique can be applied. The main code that does this can be seen below. Within to represent a collision a nodes cost is set to 255, so to generate we skip evaluating the connection if the connected has a cost of 255. Additionally, the target nodes direction is set to point directly to the target position given. This allows agents to get to the target position not just the target node.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Code that generates the flow field</span>
<span class="nf">SetAllUnreachable</span><span class="p">();</span>
<span class="n">targetNode</span><span class="p">.</span><span class="nf">SetValue</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
<span class="n">targetNode</span><span class="p">.</span><span class="nf">SetDirection</span><span class="p">(</span><span class="n">targetPosition</span> <span class="p">-</span> <span class="n">targetNode</span><span class="p">.</span><span class="nf">Position</span><span class="p">());</span>

<span class="n">Node</span> <span class="n">currentNode</span> <span class="p">=</span> <span class="n">targetNode</span><span class="p">;</span>
<span class="n">List</span><span class="p">&lt;</span><span class="n">Node</span><span class="p">&gt;</span> <span class="n">open</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Node</span><span class="p">&gt;</span> <span class="p">{</span><span class="n">currentNode</span><span class="p">};</span>
<span class="k">while</span> <span class="p">(</span><span class="n">open</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">currentNode</span> <span class="p">=</span> <span class="n">open</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
    <span class="n">open</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">currentNode</span><span class="p">);</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">int</span> <span class="n">connectedNodeID</span> <span class="k">in</span> <span class="n">currentNode</span><span class="p">.</span><span class="n">connectedNodes</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Node</span> <span class="n">connectedNode</span> <span class="p">=</span> <span class="n">_nodes</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="n">node</span> <span class="p">=&gt;</span> <span class="n">node</span><span class="p">.</span><span class="n">id</span> <span class="p">==</span> <span class="n">connectedNodeID</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">connectedNode</span><span class="p">.</span><span class="nf">Active</span><span class="p">())</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">pathLength</span> <span class="p">=</span> <span class="n">currentNode</span><span class="p">.</span><span class="n">Value</span> <span class="p">+</span> <span class="n">connectedNode</span><span class="p">.</span><span class="n">Cost</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pathLength</span> <span class="p">&lt;</span> <span class="n">connectedNode</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(!</span><span class="n">open</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">connectedNode</span><span class="p">))</span> <span class="p">{</span>
                    <span class="n">open</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">connectedNode</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="n">connectedNode</span><span class="p">.</span><span class="nf">SetValue</span><span class="p">(</span><span class="n">pathLength</span><span class="p">,</span> <span class="n">currentNode</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>To make an agent that follows the field, a forward force is given, then when moving update the rotation to look in the direction of the flow-field. The agent uses this rotation to slowly rotate towards, causing it to follow the field smoothly without instantly snapping to the new direction. To resolve issues on the very edge of the cube the agent will ignore the flow-fields direction if it will cause the agent to look at the walkable surface. Only after it gets over the edge will it then use its direction. An example flow-field with a player as the target point and an agent trying to get to the player with a collision can be seen below. The Lines between the nodes show the nodes direction vector, a greener line also helps visualise its closeness to the target.</p>

<p><img src="/_assets/images/gravity/FlowField.png" alt="FlowField" /></p>

<h2>Thanks for reading</h2>
<p>Reminder that the game can be downloaded <a href="https://skuuully.itch.io/planet-game">here</a> to play</p>


        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2021-05-08T11:08:00+01:00">May 8, 2021</time></p>


      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=Gravity+game%20http%3A%2F%2Flocalhost%3A4000%2Fgravity%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fgravity%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fgravity%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="#" class="pagination--pager disabled">Previous</a>
    
    
      <a href="/cvrs/" class="pagination--pager" title="CVRS: Covid visualisation
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/cvrs/" rel="permalink">CVRS: Covid visualisation
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-05-08T11:10:00+01:00">May 8, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">For my independent studies dissertation I decided to look at creating a virtual reality application that depicts the transmission of COVID-19 in a university...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="skuuully@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
        
      
        
          <li><a href="https://github.com/skuuully" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://skuuully.itch.io" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Itch</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 Ryan Skull. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
